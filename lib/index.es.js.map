{"version":3,"file":"index.es.js","sources":["../src/community.ts"],"sourcesContent":["import Arweave from 'arweave';\nimport axios from 'axios';\nimport { JWKInterface } from 'arweave/node/lib/wallet';\nimport { readContract, interactWriteDryRun, interactWrite, createContractFromTx, interactRead } from 'smartweave';\nimport redstone from 'redstone-api';\nimport {\n  BalancesInterface,\n  VaultInterface,\n  VoteInterface,\n  RoleInterface,\n  StateInterface,\n  InputInterface,\n  ResultInterface,\n  TagInterface,\n} from './faces';\nimport Utils from './utils';\n\nexport default class Community {\n  private readonly cacheServer: string = 'https://cache.community.xyz/';\n  private contractSrc: string = 'ngMml4jmlxu0umpiQCsHgPX2pb_Yz6YDB8f7G6j-tpI';\n  private readonly mainContract: string = 'mzvUgNc8YFk0w5K5H7c8pyT-FC5Y_ba0r7_8766Kx74';\n  private readonly txFeeUsd: number = 0.5;\n  private readonly createFeeUsd: number = 3;\n\n  private createFee: number = 0.83;\n  private txFee: number = 0.21;\n\n  private arweave: Arweave;\n  private wallet!: JWKInterface;\n  private walletAddress!: string;\n  private dummyWallet: JWKInterface;\n  private isWalletConnect: boolean = false;\n\n  // Community specific variables\n  private communityContract = '';\n  private state!: StateInterface;\n  private firstCall: boolean = true;\n  private cacheRefreshInterval: number = 1000 * 60 * 2; // 2 minutes\n  private stateCallInProgress: boolean = false;\n\n  private readonly warnAfter: number = 60 * 60 * 24 * 1000; // 24 hours\n  private updatedFees: boolean = false;\n\n  /**\n   * Before interacting with Community you need to have at least Arweave initialized.\n   * @param arweave - Arweave instance\n   * @param wallet - JWK wallet file data\n   * @param cacheRefreshInterval - Refresh interval in milliseconds for the cached state\n   */\n  constructor(arweave: Arweave, wallet?: JWKInterface, cacheRefreshInterval = 1000 * 60 * 2) {\n    this.arweave = arweave;\n\n    if (wallet) {\n      this.wallet = wallet;\n      arweave.wallets\n        .jwkToAddress(wallet)\n        .then((addy) => (this.walletAddress = addy))\n        .catch(console.log);\n    }\n\n    if (cacheRefreshInterval) {\n      this.cacheRefreshInterval = cacheRefreshInterval;\n    }\n\n    this.getFees();\n    this.events();\n  }\n\n  /**\n   * Get the Main Community contract ID\n   * @returns {Promise<string>} The main contract ID.\n   */\n  public async getMainContractId(): Promise<string> {\n    return this.mainContract;\n  }\n\n  /**\n   * Get the contract source txid used for new PSCs.\n   * @returns {Promise<string>} The contract source ID.\n   */\n  public async getContractSourceId(): Promise<string> {\n    return this.contractSrc;\n  }\n\n  /**\n   * Get the current Community contract ID\n   */\n  public async getCommunityContract(): Promise<string> {\n    return this.communityContract;\n  }\n\n  /**\n   * Get the current Community state.\n   * @param cached - Wether to return the cached version or reload\n   * @returns - The current state and sync afterwards if needed.\n   */\n  public async getState(cached = true): Promise<StateInterface> {\n    if (!this.communityContract.length) {\n      throw new Error('No community set. Use setCommunityTx to get your current state.');\n    }\n\n    if (this.firstCall) {\n      this.firstCall = false;\n      return this.update(true);\n    }\n\n    if (!cached || !this.state) {\n      return this.update(false);\n    }\n\n    return this.state;\n  }\n\n  /**\n   * Set the user wallet data.\n   * @param wallet - JWK wallet file data\n   * @returns The wallet address\n   */\n  public async setWallet(wallet: JWKInterface): Promise<string> {\n    this.wallet = wallet;\n    this.walletAddress = await this.arweave.wallets.jwkToAddress(this.wallet);\n\n    return this.walletAddress;\n  }\n\n  /**\n   * Set the states for a new Community using the Community contract.\n   * @param name - The Community name\n   * @param ticker - Currency ticker, ex: TICK\n   * @param balances - an object of wallet addresses and their token balances\n   * @param quorum - % of votes weight, for a proposal to be valid\n   * @param support = % of votes as \"yes\", for a vote to be valid\n   * @param voteLength - For how long (in blocks) should the vote be active\n   * @param lockMinLength - What is the minimum lock time (in blocks)\n   * @param lockMaxLength - What is the maximum lock time (in blocks)\n   * @param vault - Vault object, optional\n   * @param votes - Votes, optional\n   * @param roles - Roles, optional\n   * @param extraSettings - Any custom extra settings can be sent here. @since v1.1.0\n   *\n   * @returns - The created state\n   */\n  public async setState(\n    name: string,\n    ticker: string,\n    balances: BalancesInterface,\n    quorum: number = 50,\n    support: number = 50,\n    voteLength: number = 2000,\n    lockMinLength: number = 720,\n    lockMaxLength: number = 10000,\n    vault: VaultInterface = {},\n    votes: VoteInterface[] = [],\n    roles: RoleInterface = {},\n    extraSettings: [string, any][] = [],\n  ): Promise<StateInterface> {\n    // Make sure the wallet exists.\n    await this.checkWallet();\n\n    // Make sure data isn't null\n    if (!name) {\n      name = '';\n    }\n    if (!ticker) {\n      ticker = '';\n    }\n    if (!balances) {\n      balances = {};\n    }\n    if (!quorum) {\n      quorum = 0;\n    }\n    if (!support) {\n      support = 0;\n    }\n    if (!voteLength) {\n      voteLength = 0;\n    }\n    if (!lockMinLength) {\n      lockMinLength = 0;\n    }\n    if (!lockMaxLength) {\n      lockMaxLength = 0;\n    }\n    if (!vault) {\n      vault = {};\n    }\n    if (!votes) {\n      votes = [];\n    }\n    if (!roles) {\n      roles = {};\n    }\n    if (!extraSettings) {\n      extraSettings = [];\n    }\n\n    // Clean data\n    name = name.trim();\n    ticker = ticker.trim();\n    balances = Utils.trimObj(balances);\n    quorum = +quorum;\n    support = +support;\n    voteLength = +voteLength;\n    lockMinLength = +lockMinLength;\n    lockMaxLength = +lockMaxLength;\n    vault = Utils.trimObj(vault);\n    votes = Utils.trimObj(votes);\n    roles = Utils.trimObj(roles);\n\n    // Validations\n    if (name.length < 3) {\n      throw new Error('Community Name must be at least 3 characters.');\n    }\n    if (ticker.length < 3) {\n      throw new Error('Ticker must be at least 3 characters.');\n    }\n    if (!Object.keys(balances).length) {\n      throw new Error('At least one account need to be specified.');\n    }\n    for (const bal in balances) {\n      if (isNaN(balances[bal]) || !Number.isInteger(balances[bal]) || balances[bal] < 0) {\n        throw new Error('Address balances must be a positive integer.');\n      }\n    }\n    if (isNaN(quorum) || quorum < 1 || quorum > 99 || !Number.isInteger(quorum)) {\n      throw new Error('Quorum must be an integer between 1-99.');\n    }\n    quorum = quorum / 100;\n    if (isNaN(support) || support < 1 || support > 99 || !Number.isInteger(support)) {\n      throw new Error('Support must be an integer between 1-99.');\n    }\n    support = support / 100;\n    if (isNaN(voteLength) || !Number.isInteger(voteLength) || voteLength < 1) {\n      throw new Error('Vote Length must be a positive integer.');\n    }\n    if (isNaN(lockMinLength) || lockMinLength < 1 || !Number.isInteger(lockMinLength)) {\n      throw new Error('Lock Min Length must be a positive integer.');\n    }\n    if (isNaN(lockMaxLength) || lockMaxLength < lockMinLength || !Number.isInteger(lockMaxLength)) {\n      throw new Error('Lock Max Length must be a positive integer, greater than lockMinLength.');\n    }\n    if (Object.keys(vault).length) {\n      for (const key of Object.keys(vault)) {\n        for (const k in vault[key]) {\n          if (isNaN(vault[key][k].balance) || !Number.isInteger(vault[key][k].balance) || vault[key][k].balance < 0) {\n            throw new Error('Vault balance must be a positive integer.');\n          }\n        }\n      }\n    }\n\n    const settings: [string, any][] = [\n      ['quorum', quorum],\n      ['support', support],\n      ['voteLength', voteLength],\n      ['lockMinLength', lockMinLength],\n      ['lockMaxLength', lockMaxLength],\n    ];\n\n    for (let i = 0, j = extraSettings.length; i < j; i++) {\n      const s = extraSettings[i];\n      if (typeof s[0] === 'string' && typeof s[1] !== 'undefined') {\n        settings.push(s);\n      }\n    }\n\n    // Set the state\n    this.state = {\n      name,\n      ticker,\n      balances,\n      vault,\n      votes,\n      roles,\n      settings: new Map(settings),\n    };\n\n    return this.state;\n  }\n\n  /**\n   * Update the used contract source transaction ID.\n   * @param id New contract source ID.\n   * @returns boolean that validates if the update was done.\n   */\n  public async setContractSourceId(id: string): Promise<boolean> {\n    if (!Utils.isTxId(id)) {\n      return false;\n    }\n    this.contractSrc = id;\n    return true;\n  }\n\n  /**\n   * Create a new Community with the current, previously saved (with `setState`) state.\n   * @param tags - optional: tags to be added to this transaction\n   * @returns The created community transaction ID.\n   */\n  public async create(tags: TagInterface[] = []): Promise<string> {\n    // Create the new Community.\n    const { target, winstonQty } = await this.chargeFee(this.createFee);\n\n    const toSubmit: any = this.state;\n    toSubmit.settings = Array.from(this.state.settings);\n\n    tags = [\n      ...(await this.cleanTags(tags)),\n      ...[\n        { name: 'Action', value: 'CreateCommunity' },\n        { name: 'Message', value: `Created Community ${this.state.name}, ticker: ${this.state.ticker}.` },\n        { name: 'Service', value: 'CommunityXYZ' },\n      ],\n    ];\n\n    const communityID = await createContractFromTx(\n      this.arweave,\n      this.wallet,\n      this.contractSrc,\n      JSON.stringify(toSubmit),\n      tags,\n      target,\n      winstonQty,\n    );\n    this.communityContract = communityID;\n    return communityID;\n  }\n\n  /**\n   * Get the current create cost of a community.\n   * @param inAr - Return in winston or AR\n   * @param options - If return inAr is set to true, these options are used to format the returned AR value.\n   */\n  public async getCreateCost(\n    inAr = false,\n    options?: { formatted: boolean; decimals: number; trim: boolean },\n  ): Promise<string> {\n    if (!this.updatedFees) {\n      await new Promise((resolve) => setTimeout(() => resolve(true), 100));\n      return this.getCreateCost(inAr, options);\n    }\n\n    const res = this.arweave.ar.arToWinston(this.createFee.toString());\n    if (inAr) {\n      return this.arweave.ar.winstonToAr(res, options);\n    }\n\n    return res;\n  }\n\n  /**\n   * Get the current action (post interaction) cost of a community.\n   * @param inAr - Return in winston or AR\n   * @param options - If return inAr is set to true, these options are used to format the returned AR value.\n   */\n  public async getActionCost(\n    inAr = false,\n    options?: { formatted: boolean; decimals: number; trim: boolean },\n  ): Promise<string> {\n    if (!this.updatedFees) {\n      await new Promise((resolve) => setTimeout(() => resolve(true), 100));\n      return this.getActionCost(inAr, options);\n    }\n\n    const res = this.arweave.ar.arToWinston(this.txFee.toString());\n    if (inAr) {\n      return this.arweave.ar.winstonToAr(res, options);\n    }\n\n    return res;\n  }\n\n  /**\n   * Set the Community interactions to this transaction ID.\n   * @param txId Community's Transaction ID\n   * @returns boolean - True if successful, false if error.\n   */\n  public async setCommunityTx(txId: string): Promise<boolean> {\n    // reset state\n    this.state = null;\n    this.communityContract = txId;\n\n    try {\n      await this.getState(false);\n    } catch (e) {\n      this.state = null;\n      this.communityContract = null;\n      console.log(e);\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Do a GET call to any function on the contract.\n   * @param params - InputInterface\n   * @returns ResultInterface\n   */\n  public async get(params: InputInterface = { function: 'balance' }): Promise<ResultInterface> {\n    if (!this.wallet && !this.dummyWallet) {\n      this.dummyWallet = await this.arweave.wallets.generate();\n    }\n\n    return interactRead(this.arweave, this.wallet || this.dummyWallet, this.communityContract, params);\n  }\n\n  /**\n   * Get the target or current wallet token balance\n   * @param target The target wallet address\n   * @returns Current target token balance\n   */\n  public async getBalance(target: string = this.walletAddress): Promise<number> {\n    const res = await this.get({ function: 'balance', target });\n    return res.balance;\n  }\n\n  /**\n   * Get the target or current wallet unlocked token balance\n   * @param target The target wallet address\n   * @returns Current target token balance\n   */\n  public async getUnlockedBalance(target: string = this.walletAddress): Promise<number> {\n    const res = await this.get({ function: 'unlockedBalance', target });\n    return res.balance;\n  }\n\n  /**\n   * Get the target or current wallet vault balance\n   * @param target The target wallet address\n   * @returns Current target token balance\n   */\n  public async getVaultBalance(target: string = this.walletAddress): Promise<number> {\n    const res = await this.get({ function: 'vaultBalance', target });\n    return res.balance;\n  }\n\n  /**\n   * Get the target or current wallet role\n   * @param target The target wallet address\n   * @returns Current target role\n   */\n  public async getRole(target: string = this.walletAddress): Promise<string> {\n    const res = await this.get({ function: 'role', target });\n    return res.role;\n  }\n\n  /**\n   * Select one of your community holders based on their weighted total balance.\n   * @param balances  - State balances, optional.\n   * @param vault - State vault, optional.\n   */\n  public async selectWeightedHolder(\n    balances: BalancesInterface = this.state.balances,\n    vault: VaultInterface = this.state.vault,\n  ) {\n    if (!this.state) {\n      throw new Error('Need to initilate the state and worker.');\n    }\n\n    let totalTokens = 0;\n    for (const addy of Object.keys(balances)) {\n      totalTokens += balances[addy];\n    }\n    for (const addy of Object.keys(vault)) {\n      if (!vault[addy].length) continue;\n      const vaultBalance = vault[addy].map((a) => a.balance).reduce((a, b) => a + b, 0);\n      totalTokens += vaultBalance;\n      if (addy in balances) {\n        balances[addy] += vaultBalance;\n      } else {\n        balances[addy] = vaultBalance;\n      }\n    }\n\n    const weighted: BalancesInterface = {};\n    for (const addy of Object.keys(balances)) {\n      weighted[addy] = balances[addy] / totalTokens;\n    }\n\n    let sum = 0;\n    const r = Math.random();\n    for (const addy of Object.keys(weighted)) {\n      sum += weighted[addy];\n      if (r <= sum && weighted[addy] > 0) {\n        return addy;\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Get the current fee charged for actions on Community.\n   * @return {object} - The txFee and the createFee, both are numbers.\n   */\n  public async getFees(): Promise<{ txFee: number; createFee: number }> {\n    try {\n      const price = await redstone.getPrice('AR');\n\n      const createdAt = price.timestamp;\n      const arPrice = price.value;\n\n      if (createdAt && arPrice) {\n        const deployTime = new Date().getTime() - createdAt;\n        if (deployTime > this.warnAfter) {\n          console.warn(\"Price hasn't been updated over a day ago!\");\n        }\n\n        this.createFee = +(this.createFeeUsd / arPrice).toFixed(5);\n        this.txFee = +(this.txFeeUsd / arPrice).toFixed(5);\n      }\n    } catch (e) {\n      console.log(e);\n      console.warn('Was not able to update the fees, please try again later');\n    }\n\n    this.updatedFees = true;\n    return {\n      createFee: this.createFee,\n      txFee: this.txFee,\n    };\n  }\n\n  // Setters\n\n  /**\n   * Transfer token balances to another account.\n   * @param target - Target Wallet Address\n   * @param qty - Amount of the token to send\n   * @param tags - optional: tags to be added to this transaction\n   * @returns The transaction ID for this action\n   */\n  public async transfer(target: string, qty: number, tags: TagInterface[] = []): Promise<string> {\n    tags = [\n      ...(await this.cleanTags(tags)),\n      ...[\n        { name: 'Action', value: 'transfer' },\n        { name: 'Message', value: `Transfer to ${target} of ${Utils.formatNumber(qty)}.` },\n        { name: 'Community-ID', value: this.communityContract },\n        { name: 'Service', value: 'CommunityXYZ' },\n      ],\n    ];\n\n    return this.interact({ function: 'transfer', target, qty }, tags);\n  }\n\n  /**\n   * Transfer tokens to an account's vault.\n   * @param target - Target Wallet Address\n   * @param qty - Amount of the token to send\n   * @param lockLength - For how many blocks to lock the tokens\n   * @param tags - optional: tags to be added to this transaction\n   * @returns The transaction ID for this action\n   */\n  public async transferLocked(\n    target: string,\n    qty: number,\n    lockLength: number,\n    tags: TagInterface[] = [],\n  ): Promise<string> {\n    tags = [\n      ...(await this.cleanTags(tags)),\n      ...[\n        { name: 'Action', value: 'transferLocked' },\n        {\n          name: 'Message',\n          value: `Transfer locked to ${target} of ${Utils.formatNumber(qty)} for ${Utils.formatNumber(\n            lockLength,\n          )} blocks.`,\n        },\n        { name: 'Community-ID', value: this.communityContract },\n        { name: 'Service', value: 'CommunityXYZ' },\n      ],\n    ];\n\n    return this.interact({ function: 'transferLocked', target, qty, lockLength }, tags);\n  }\n\n  /**\n   * Lock your balances in a vault to earn voting weight.\n   * @param qty - Positive integer for the quantity to lock\n   * @param lockLength - Length of the lock, in blocks\n   * @param tags - optional: tags to be added to this transaction\n   * @returns The transaction ID for this action\n   */\n  public async lockBalance(qty: number, lockLength: number, tags: TagInterface[] = []): Promise<string> {\n    tags = [\n      ...(await this.cleanTags(tags)),\n      ...[\n        { name: 'Action', value: 'lock' },\n        {\n          name: 'Message',\n          value: `Locked ${Utils.formatNumber(qty)} for ${Utils.formatNumber(lockLength)} blocks (${Utils.formatBlocks(\n            lockLength,\n          )}).`,\n        },\n        { name: 'Community-ID', value: this.communityContract },\n        { name: 'Service', value: 'CommunityXYZ' },\n      ],\n    ];\n\n    return this.interact({ function: 'lock', qty, lockLength }, tags);\n  }\n\n  /**\n   * Unlock all your locked balances that are over the lock period.\n   * @param tags - optional: tags to be added to this transaction\n   * @returns The transaction ID for this action\n   */\n  public async unlockVault(tags: TagInterface[] = []): Promise<string> {\n    tags = [\n      ...(await this.cleanTags(tags)),\n      ...[\n        { name: 'Action', value: 'unlock' },\n        { name: 'Message', value: `Unlocked vaults.` },\n        { name: 'Community-ID', value: this.communityContract },\n        { name: 'Service', value: 'CommunityXYZ' },\n      ],\n    ];\n    return this.interact({ function: 'unlock' }, tags);\n  }\n\n  /**\n   * Increase the lock time (in blocks) of a vault.\n   * @param vaultId - The vault index position to increase\n   * @param lockLength - Length of the lock, in blocks\n   * @param tags - optional: tags to be added to this transaction\n   * @returns The transaction ID for this action\n   */\n  public async increaseVault(vaultId: number, lockLength: number, tags: TagInterface[] = []): Promise<string> {\n    tags = [\n      ...(await this.cleanTags(tags)),\n      ...[\n        { name: 'Action', value: 'increase' },\n        {\n          name: 'Message',\n          value: `Increased vault ID ${vaultId} for ${lockLength} blocks (${Utils.formatBlocks(lockLength)}).`,\n        },\n        { name: 'Community-ID', value: this.communityContract },\n        { name: 'Service', value: 'CommunityXYZ' },\n      ],\n    ];\n    return this.interact({ function: 'increaseVault', id: vaultId, lockLength }, tags);\n  }\n\n  /**\n   * Create a new vote\n   * @param params VoteInterface without the \"function\"\n   * @param tags - optional: tags to be added to this transaction\n   * @returns The transaction ID for this action\n   */\n  public async proposeVote(params: VoteInterface, tags: TagInterface[] = []): Promise<string> {\n    const pCopy: VoteInterface = JSON.parse(JSON.stringify(params));\n    console.log(pCopy);\n\n    if (pCopy.type === 'set') {\n      if (\n        pCopy.key === 'quorum' ||\n        pCopy.key === 'support' ||\n        pCopy.key === 'lockMinLength' ||\n        pCopy.key === 'lockMaxLength'\n      ) {\n        pCopy.value = +pCopy.value;\n      }\n\n      if (pCopy.key === 'quorum' || pCopy.key === 'support') {\n        if (pCopy.value > 0 && pCopy.value < 100) {\n          pCopy.value = pCopy.value / 100;\n        } else if (pCopy.value <= 0 || pCopy.value >= 100) {\n          throw new Error('Invalid value.');\n        }\n      }\n\n      if (\n        pCopy.key === 'lockMinLength' &&\n        (pCopy.value < 1 || pCopy.value > this.state.settings.get('lockMaxLength'))\n      ) {\n        throw new Error('Invalid minimum lock length.');\n      }\n      if (\n        pCopy.key === 'lockMaxLength' &&\n        (pCopy.value < 1 || pCopy.value < this.state.settings.get('lockMinLength'))\n      ) {\n        throw new Error('Invalid maximum lock length.');\n      }\n    }\n\n    const input: InputInterface = { ...pCopy, function: 'propose' };\n\n    tags = [\n      ...(await this.cleanTags(tags)),\n      ...[\n        { name: 'Action', value: 'propose' },\n        {\n          name: 'Message',\n          value: `Proposed ${pCopy.type === 'indicative' || pCopy.key === 'other' ? 'an' : 'a'} ${\n            pCopy.key || pCopy.type\n          } vote, value: ${pCopy.value}.`,\n        },\n        { name: 'Community-ID', value: this.communityContract },\n        { name: 'Service', value: 'CommunityXYZ' },\n      ],\n    ];\n    return this.interact(input, tags);\n  }\n\n  /**\n   * Cast a vote on an existing, and active, vote proposal.\n   * @param id - The vote ID, this is the index of the vote in votes\n   * @param cast - Cast your vote with 'yay' (for yes) or 'nay' (for no)\n   * @param tags - optional: tags to be added to this transaction\n   * @returns The transaction ID for this action\n   */\n  public async vote(id: number, cast: 'yay' | 'nay', tags: TagInterface[] = []): Promise<string> {\n    tags = [\n      ...(await this.cleanTags(tags)),\n      ...[\n        { name: 'Action', value: 'vote' },\n        { name: 'Message', value: `Voted on vote ID ${id}: ${cast}.` },\n        { name: 'Community-ID', value: this.communityContract },\n        { name: 'Service', value: 'CommunityXYZ' },\n      ],\n    ];\n    return this.interact({ function: 'vote', id, cast }, tags);\n  }\n\n  /**\n   * Finalize a vote, to run the desired vote details if approved, or reject it and close.\n   * @param id - The vote ID, this is the index of the vote in votes\n   * @param tags - optional: tags to be added to this transaction\n   * @returns The transaction ID for this action\n   */\n  public async finalize(id: number, tags: TagInterface[] = []): Promise<string> {\n    tags = [\n      ...(await this.cleanTags(tags)),\n      ...[\n        { name: 'Action', value: 'finalize' },\n        { name: 'Message', value: `Finalize completed votes.` },\n        { name: 'Community-ID', value: this.communityContract },\n        { name: 'Service', value: 'CommunityXYZ' },\n      ],\n    ];\n    return this.interact({ function: 'finalize', id }, tags);\n  }\n\n  /**\n   * Charge a fee for each Community's interactions.\n   * @param fee - which fee to charge\n   */\n  private async chargeFee(fee: number = this.txFee): Promise<{ target: string; winstonQty: string }> {\n    const balance = await this.arweave.wallets.getBalance(this.walletAddress);\n\n    if (+balance < +fee) {\n      throw new Error('Not enough balance.');\n    }\n\n    let state: StateInterface;\n    try {\n      state = (await axios(`${this.cacheServer}contract/${this.mainContract}`)).data;\n    } catch (e) {\n      state = await readContract(this.arweave, this.mainContract);\n    }\n\n    const target = await this.selectWeightedHolder(state.balances, state.vault);\n    if (target === this.walletAddress) {\n      return {\n        target: '',\n        winstonQty: '0',\n      };\n    }\n\n    return {\n      target,\n      winstonQty: this.arweave.ar.arToWinston(fee.toString()),\n    };\n  }\n\n  /**\n   * Function used to check if the user is already logged in\n   */\n  private async checkWallet(): Promise<void> {\n    if (!this.wallet && !this.isWalletConnect) {\n      throw new Error(\n        'You first need to set the user wallet, you can do this while on new Community(..., wallet) or using setWallet(wallet).',\n      );\n    }\n  }\n\n  /**\n   * Stringify and remove tags that are defined by CommunityJS\n   * @returns An array of the TagInterface object `{name: string, value: string}`\n   */\n  private async cleanTags(tags: TagInterface[]): Promise<TagInterface[]> {\n    if (!tags || !tags.length) {\n      return [];\n    }\n\n    const blacklist: string[] = ['action', 'message', 'community-id', 'service', 'type'];\n    const res: TagInterface[] = [];\n\n    for (const tag of tags) {\n      if (!tag.name || !tag.value) continue;\n\n      if (!blacklist.includes(tag.name.toLowerCase())) {\n        res.push({\n          name: tag.name.toString(),\n          value: tag.value.toString(),\n        });\n      }\n    }\n\n    return res;\n  }\n\n  /**\n   * Updates the current state used for a Community instance\n   * @param recall Auto recall this function each cacheRefreshInterval ms\n   */\n  private async update(recall = false): Promise<StateInterface> {\n    if (!this.communityContract.length) {\n      setTimeout(() => this.update(), this.cacheRefreshInterval);\n      return;\n    }\n\n    if (this.stateCallInProgress) {\n      const getLastState = async (): Promise<StateInterface> => {\n        if (this.stateCallInProgress) {\n          return new Promise((resolve) => setTimeout(() => resolve(getLastState()), 1000));\n        }\n\n        return this.state;\n      };\n      return getLastState();\n    }\n\n    this.stateCallInProgress = true;\n\n    let state: StateInterface;\n    try {\n      state = (await axios(`${this.cacheServer}contract/${this.communityContract}`)).data;\n    } catch (e) {\n      state = await readContract(this.arweave, this.communityContract);\n    }\n\n    state.settings = new Map(state.settings);\n    this.state = state;\n\n    this.stateCallInProgress = false;\n\n    if (recall) {\n      setTimeout(() => this.update(true), this.cacheRefreshInterval);\n    }\n    return this.state;\n  }\n\n  /**\n   * The most important function, it writes to the contract.\n   * @param input - InputInterface\n   * @param tags - Array of tags as an object with name and value as strings\n   * @param fee - Transaction fee\n   */\n  private async interact(\n    input: InputInterface,\n    tags: { name: string; value: string }[],\n    fee: number = this.txFee,\n  ): Promise<string> {\n    const { target, winstonQty } = await this.chargeFee(fee);\n\n    tags.push({ name: 'Type', value: 'ArweaveActivity' });\n\n    const res = await interactWriteDryRun(\n      this.arweave,\n      this.wallet || 'use_wallet',\n      this.communityContract,\n      input,\n      tags,\n      target,\n      winstonQty,\n    );\n    if (res.type === 'error') {\n      //  || res.type === 'exception'\n      throw new Error(res.result);\n    }\n\n    return interactWrite(\n      this.arweave,\n      this.wallet || 'use_wallet',\n      this.communityContract,\n      input,\n      tags,\n      target,\n      winstonQty,\n    );\n  }\n\n  /**\n   * Create events to handle the wallet connect feature\n   */\n  private events() {\n    const win: any =\n      typeof window !== 'undefined'\n        ? window\n        : {\n            removeEventListener: (evName: string) => {},\n            addEventListener: (evName: string, callback: (e: any) => {}) => {},\n          };\n\n    async function walletConnect() {\n      this.walletAddress = await this.arweave.wallets.getAddress();\n      this.isWalletConnect = true;\n    }\n    async function walletSwitch(e: any) {\n      this.walletAddress = await e.detail.address;\n      this.isWalletConnect = true;\n    }\n\n    win.removeEventListener('arweaveWalletLoaded', () => walletConnect());\n    win.removeEventListener('walletSwitch', (e) => walletSwitch(e));\n    win.addEventListener('arweaveWalletLoaded', () => walletConnect());\n    win.addEventListener('walletSwitch', (e) => walletSwitch(e));\n  }\n}\n"],"names":[],"mappings":"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"}